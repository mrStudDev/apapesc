
{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}

{% block title %}Super-Dashboard{% endblock title %}

{% block dashboard %}

<body class="font-sans bg-gray-100 text-gray-900" xmlns="http://www.w3.org/1999/html">

    <!-- Navbar -->
    {% include "components/navbar_associacao.html" %}

  <!-- Container geral para o conte√∫do -->
  <div class="flex flex-col min-h-screen max-w-7xl mx-auto px-6 py-8">
    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
            <div class="p-4 rounded-md text-white 
                {% if message.tags == 'success' %}
                    bg-green-500
                {% elif message.tags == 'error' %}
                    bg-red-500
                {% elif message.tags == 'info' %}
                    bg-blue-500
                {% else %}
                    bg-gray-500
                {% endif %}
            ">
                {{ message }}
            </div>
        {% endfor %}
    </div>
    {% endif %}
    <div class="mb-10 text-center">
      <h1 class="text-4xl font-extrabold text-gray-800">üìà Dashboard Geral</h1>
      <p class="mt-2 text-gray-600">Vis√£o consolidada das atividades e dados do sistema</p>
    </div>
    

    <!-- √Årea de conte√∫do principal -->
    <div class="flex-1 p-6">
        <div class="text-gray-400">Super-Dashboard</div>      
      <!-- Pain√©is de dados -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">

      <!-- Painel de Associados -->
      <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">üë• Cadastros</h3>
        <div class="grid grid-cols-2 gap-4 text-center">
          <div>
            <div class="text-4xl font-bold text-blue-800">{{ total_associados }}</div>
            <p class="text-sm text-gray-600">Total Geral</p>
          </div>
          <div>
            <div class="text-4xl font-bold text-blue-600">{{ associados_ativos }}</div>
            <p class="text-sm text-gray-600">Ativos</p>
          </div>
          <div>
            <div class="text-4xl font-bold text-blue-600">{{ associados_aposentados }}</div>
            <p class="text-sm text-gray-600">Aposentados</p>
          </div>
          <div>
            <div class="text-4xl font-bold text-blue-600">{{ associados_especiais }}</div>
            <p class="text-sm text-gray-600">Clientes</p>
          </div>
          <div>
            <div class="text-4xl font-bold text-blue-600">{{ total_candidatos }}</div>
            <p class="text-sm text-gray-600">Candidatos</p>
          </div>
          <div>
            <div class="text-4xl font-bold text-blue-600">{{ total_desassociados }}</div>
            <p class="text-sm text-gray-600">Desassociados</p>
          </div>
        </div>
        <div class="mt-4 text-sm text-right space-x-4 py-4">
          <a href="{% url 'app_associados:list_geral_associado' %}" class="text-blue-600 hover:underline">üîó Ver todos os Associados</a>
        </div>
      </div>


        <!-- Card: Embarca√ß√µes + Licen√ßas -->
        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">üö§ Embarca√ß√µes & Licen√ßas</h3>
          <div class="flex flex-col gap-4">
            <div>
              <p class="text-sm font-medium text-gray-600">Total de Embarca√ß√µes</p>
              <div class="text-4xl font-bold text-blue-500">{{ total_embarcacoes }}</div>
            </div>
            <div class="grid grid-cols-2 gap-4 text-sm text-gray-700">
              <div>
                <p class="font-medium">Motor:</p>
                <p>{{ embarcacoes_motor }}</p>
              </div>
              <div>
                <p class="font-medium">Vela:</p>
                <p>{{ embarcacoes_vela }}</p>
              </div>
            </div>
            <hr class="my-2 border-gray-200">
            <div>
              <p class="text-sm font-medium text-gray-600">Total de Licen√ßas</p>
              <div class="text-4xl font-bold text-blue-500">{{ total_licencas }}</div>
            </div>
          </div>
          <div class="mt-4 text-sm text-right space-x-4">
            <a href="{% url 'app_embarcacoes:list_embarcacoes' %}" class="text-blue-600 hover:underline">üõ•Ô∏è Embarca√ß√µes</a>
            <a href="{% url 'app_licencas:list_licencas' %}" class="text-blue-600 hover:underline">üìÑ Licen√ßas</a>
          </div>
        </div>

        <!-- Painel de Relat√≥rios -->
        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 w-full max-w-md mx-auto">
          <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
            üìã <span>Extra-Associados</span>
          </h3>
        
          <!-- Total -->
          <div class="text-4xl font-bold text-blue-500 mb-4">{{ total_extra_associados }}</div>
        
          <!-- Servi√ßos recentes -->
          <div class="mb-4">
            <h4 class="text-sm font-medium text-gray-600 mb-2">üïí Servi√ßos recentes:</h4>
            <div class="space-y-2 text-sm text-gray-700 border-t pt-3">
              {% for servico in servicos_extras_recentes %}
              <div class="flex justify-between">
                <a href="{% url 'app_servicos:single_servico_extra' servico.id %}" class="text-blue-700 hover:underline">
                  {{ servico.extra_associado.nome_completo }}
                </a>
                <span class="text-gray-500">{{ servico.tipo_servico.nome }}</span>
              </div>
              {% empty %}
              <p class="text-gray-400 italic">Nenhum servi√ßo extra recente.</p>
              {% endfor %}
            </div>
          </div>
        
          <!-- Links √∫teis -->
          <div class="border-t pt-4 space-y-3 text-sm text-gray-700">
            <a href="{% url 'app_servicos:list_extraassociados' %}" class="flex items-center hover:text-blue-600 transition-colors">
              <i class="material-icons mr-2 text-base">group</i>
              Lista de Extra-Associados
            </a>
        
            <a href="{% url 'app_servicos:list_extraassociados'  %}" class="flex items-center hover:text-green-600 transition-colors">
              <i class="material-icons mr-2 text-base">add_circle</i>
              Novo Servi√ßo para Extra-Associado
            </a>
          </div>
        </div>
      </div>
      <!-- üîπ Gr√°fico de Linhas para Filia√ß√£o de Associados -->
      <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
          <h3 class="text-xl font-semibold text-gray-800">Filia√ß√£o de Associados por Ano e M√™s</h3>
          <div style="height: 400px; width: 100%;">
              <canvas id="graficoAssociados"></canvas>
          </div>
      </div>
      <br>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        <!-- Painel de Relat√≥rios -->
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md mx-auto">
          <h3 class="text-xl font-semibold text-gray-800">üßë‚Äçüíª Admin</h3>
          <div class="mt-4 text-4xl font-bold text-blue-500">Directs</div>
          <div class="mt-4 text-sm text-gray-600">
            <hr class="my-3 border-gray-300">
            <ul class="space-y-3">   
              <li>
                <a href="{% url 'app_finances:list_despesas' %}" class="flex items-center text-green-700 hover:green-red-500 transition-colors">
                  <i class="material-icons mr-2 text-green-700 group-hover:green-red-500">pending_actions</i>
                  Lista Despesas
                </a>
              </li>
            
              <li>
                <a href="{% url 'app_finances:list_anuidades' %}" class="flex items-center text-green-700 hover:text-green-500 transition-colors">
                  <i class="material-icons mr-2 text-green-700 group-hover:text-green-500">request_quote</i>
                  Lista Anuidades
                </a>
              </li>
            
              <li>
                <a href="{% url 'app_finances:create_anuidade' %}" class="flex items-center text-green-700 hover:text-green-500 transition-colors">
                  <i class="material-icons mr-2 text-green-700 group-hover:text-green-500">add_circle</i>
                  Lan√ßar Anuidade
                </a>
              </li>
              <li>
                <a href="{% url 'app_finances:list_entradas' %}" class="flex items-center text-blue-700 hover:text-blue-500 transition-colors">
                  <i class="material-icons mr-2 text-blue-700 group-hover:text-blue-500">assessment</i>
                  Lista Entradas
                </a>
              </li>            
              <li>
                <a href="{% url 'app_finances:create_entrada' %}" class="flex items-center text-gray-700 hover:text-yellow-500 transition-colors">
                  <i class="material-icons mr-2 text-gray-700 group-hover:text-gray-500">add</i>
                  Lan√ßar Entrada Desvinculada
                </a>
              </li>
            
              <li>
                <a href="{% url 'app_servicos:list_extraassociados' %}" class="flex items-center text-orange-700 hover:text-green-500 transition-colors">
                  <i class="material-icons mr-2 text-orange-700 group-hover:text-orange-500">group_add</i>
                  Entrada Extra-Associado
                </a>
              </li>
            
            
              <li>
                <a href="{% url 'app_beneficios:create_beneficio' %}" class="flex items-center text-purple-700 hover:text-purple-500 transition-colors">
                  <i class="material-icons mr-2 text-purple-700 group-hover:text-purple-500">card_giftcard</i>
                  Lan√ßar Benef√≠cio
                </a>
              </li>

            </ul>
          </div>
        </div>        

        <!-- Painel de Artigo -->
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md mx-auto">
          <h3 class="text-xl font-semibold text-black-600">üìùArtigos</h3>
          {% if total_articles %}
            <div class="mt-4 text-5xl font-bold text-blue-500">{{total_articles}}</div>
          {% else %}
            <p>Nenhum artigo encontrado.</p>
          {% endif %}
          <div class="mt-4 text-sm text-gray-600">
            <hr class="my-3 border-gray-300">
            <ul class="space-y-2">
              {% for article in articles %}
              <li>
                <a href="{% url 'app_articles:single_article' article.slug %}" class="flex items-center text-gray-700 hover:text-orange-600 transition-colors">
                  <i class="material-icons mr-2">check_circle</i>
                  {{article.title}}
                </a>
              </li>
              {% endfor %}
              <!-- Additional Tarefas links -->
            </ul>
          </div>
        </div>
        <div class="bg-white p-4 rounded shadow">
          <h2 class="text-xl font-bold text-gray-700 mb-4">üåä Esp√©cies Marinhas</h2>
        
          <div class="flex justify-between mb-4">
            <p class="text-gray-700 font-medium">Total:</p>
            <p class="text-blue-600 font-bold">{{ total_especies }}</p>
          </div>
        
          <div class="border-t pt-3 space-y-2 text-sm text-gray-700">
            {% for especie in ultimas_especies %}
              <a href="{% url 'app_especies_maritimas:single_especie' especie.slug %}" 
                 class="flex items-center justify-between hover:text-blue-600 transition-colors">
                <div class="flex items-center gap-2">
                  <i class="material-icons text-sm text-blue-400">üêü</i>
                  <span class="font-medium">{{ especie.nome_comum }}</span>
                </div>
                <span class="text-gray-500 italic">{{ especie.nome_cientifico }}</span>
              </a>
            {% empty %}
              <p class="text-gray-400">Nenhuma esp√©cie cadastrada ainda.</p>
            {% endfor %}
          </div>
        </div>
        
    </div>

    <div class="mt-8 bg-white border border-gray-200 rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-md font-bold text-gray-800 flex items-center gap-2">
          <span class="material-icons text-blue-500 text-base">fact_check</span>
          Situa√ß√£o Atual INSS ‚Äì {{ ultimo_lancamento.mes|stringformat:"02d" }}/{{ ultimo_lancamento.ano }}
        </h3>
    
        <!-- Link para a lista de lan√ßamentos -->
        <a href="{% url 'app_tarefas:list_lancamentos' %}" 
           class="text-blue-500 hover:text-blue-700 transition text-sm flex items-center gap-1"
           title="Ver todos os lan√ßamentos">
          <span class="material-icons text-base">list_alt</span>
          <span class="hidden sm:inline">Lan√ßamentos</span>
        </a>
      </div>
    
      <h4 class="text-sm text-gray-600 mb-4">
        Problemas de acesso (m√™s atual): 
      </h4>
      <ul class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-700">
        <li class="flex items-center gap-2 bg-yellow-50 border border-yellow-200 rounded px-3 py-2">
          üßë‚Äçüíª <span>Validar Acesso:</span> <strong>{{ inss_observacoes.validar_acesso|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-red-50 border border-red-200 rounded px-3 py-2">
          üîê <span>Senha Inv√°lida:</span> <strong>{{ inss_observacoes.senha_invalida|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-orange-50 border border-orange-200 rounded px-3 py-2">
          ü™™  <span>N√≠vel de Conta:</span> <strong>{{ inss_observacoes.nivel_conta|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-gray-50 border border-gray-200 rounded px-3 py-2">
          üë§ <span>Sem Login:</span> 
          <strong>{{ inss_observacoes.sem_login|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-gray-50 border border-gray-200 rounded px-3 py-2">
          üìÉ <span>Sem CAEPF:</span> 
          <strong>{{ inss_observacoes.sem_caepf|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-green-50 border border-green-200 rounded px-3 py-2">
          ‚úÖ <span>Acesso OK:</span> <strong>{{ inss_observacoes.certo|default:"0" }}</strong>
        </li>
      </ul>
      <br>
      <h4 class="text-sm text-gray-600 mb-4">Status - Controle dos Pagamentos INSS do Ano Atual (td per√≠odo):</h4>
      <ul class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm text-gray-700">
        <li class="flex items-center gap-2 bg-yellow-50 border border-yellow-200 rounded px-3 py-2">
          ‚è≥ <span>Pendente:</span> <strong>{{ inss_status_ano.pendente|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-blue-50 border border-blue-200 rounded px-3 py-2">
          üì§ <span>Emitida:</span> <strong>{{ inss_status_ano.emitida|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-green-50 border border-green-200 rounded px-3 py-2">
          üí∏ <span>Paga:</span> <strong>{{ inss_status_ano.paga|default:"0" }}</strong>
        </li>
        <li class="flex items-center gap-2 bg-red-50 border border-red-200 rounded px-3 py-2">
          ‚ö†Ô∏è <span>Atrasada:</span> <strong>{{ inss_status_ano.atrasada|default:"0" }}</strong>
        </li>
      </ul>
    </div>
    <br>
  
    <!-- Card: Servi√ßos Recentes -->
    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
      <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
        <div class="flex items-center space-x-2">
          <span class="inline-flex items-center justify-center w-8 h-8 bg-green-100 text-green-600 rounded-full">
            üõ†Ô∏è
          </span>
          <span class="text-md font-semibold text-green-800">Painel Servi√ßos</span>
        </div>
        
      </h2>
    
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Servi√ßos para Associados -->
        <div>
          <h3 class="text-xl font-semibold text-blue-700 mb-2">üë• Associados ({{ total_servicos_associados }})</h3>
          <ul class="text-sm text-gray-700 space-y-2">
            {% for servico in servicos_associados_recentes %}
            <li class="flex items-start">
              <span class="mr-2 mt-0.5 text-blue-700">üîµ</span>
              <a href="{% url 'app_servicos:single_servico' servico.id %}" class="block hover:bg-gray-50 p-1 rounded transition">
                <div>
                  <span class="font-medium text-blue-700 underline">
                    {{ servico.tipo_servico.nome }}
                  </span> ‚Äì 
                  {{ servico.associado.user.get_full_name }}
                  <span class="text-gray-500 text-xs block">
                    ({{ servico.data_inicio|date:"d/m/Y" }})
                  </span>
                </div>
              </a>
            </li>
            {% empty %}
            <li class="text-gray-400 italic">Nenhum servi√ßo encontrado</li>
            {% endfor %}
          </ul>
        </div>
    
        <!-- Servi√ßos para Extra Associados -->
        <div>
          <h3 class="text-lg font-semibold text-orange-600 mb-2">üßæ Extra Associados ({{ total_servicos_extras }})</h3>
          <ul class="text-sm text-gray-700 space-y-2">
            {% for servico in servicos_extras_recentes %}
            <li class="flex items-start">
              <span class="mr-2 mt-0.5 text-orange-500">üü†</span>
              <a href="{% url 'app_servicos:single_servico_extra' servico.id %}" class="block hover:bg-gray-50 p-1 rounded transition">
                <div>
                  <span class="font-medium text-orange-600 underline">
                    {{ servico.tipo_servico.nome }}
                  </span> ‚Äì 
                  {{ servico.extra_associado.nome_completo }}
                  <span class="text-gray-500 text-xs block">
                    ({{ servico.data_inicio|date:"d/m/Y" }})
                  </span>
                </div>
              </a>
            </li>
            
            {% empty %}
            <li class="text-gray-400 italic">Nenhum servi√ßo encontrado</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    
      <!-- üîó Link para lista completa -->
      <div class="mt-6 text-right">
        <a href="{% url 'app_servicos:list_servicos' %}" class="inline-block text-sm font-semibold text-blue-600 hover:underline hover:text-blue-800 transition">
          üìÇ Ver todos os servi√ßos
        </a>
      </div>
    </div>

    <!-- üî∏ Gr√°fico de Servi√ßos por M√™s -->
    <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Servi√ßos Realizados por M√™s</h3>
      <div style="height: 400px; width: 100%;">
        <canvas id="graficoServicos"></canvas>
      </div>
    </div>


      <!-- Painel de Tarefas -->
    <div class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-gray-100">
      <h3 class="text-lg font-semibold flex items-center space-x-2 mb-4">
        <span class="inline-flex items-center justify-center w-8 h-8 bg-purple-100 text-purple-600 rounded-full">
          üìã
        </span>
        <span class="text-purple-800">√öltimas Tarefas</span>
      </h3>
    

    <div class="flex justify-between mb-4 text-sm">
      <p class="text-gray-700 font-medium">Total de Tarefas:</p>
      <p class="text-blue-600 font-bold">{{ total_tarefas }}</p>
    </div>

    <ul class="divide-y divide-gray-100 text-sm text-gray-800">
      {% for tarefa in tarefas %}
      <li class="py-3">
        <div class="flex justify-between items-center mb-1">
          <span class="font-semibold">{{ tarefa.titulo }}</span>
          <span class="text-xs px-2 py-1 rounded-full font-medium
            {% if tarefa.status == 'pendente' %} bg-yellow-100 text-yellow-800
            {% elif tarefa.status == 'em_andamento' %} bg-blue-100 text-blue-800
            {% elif tarefa.status == 'concluida' %} bg-green-100 text-green-800
            {% elif tarefa.status == 'devolvida' %} bg-red-100 text-red-700
            {% elif tarefa.status == 'arquivada' %} bg-gray-200 text-gray-600
            {% endif %}">
            {{ tarefa.get_status_display }}
          </span>
        </div>

        <div class="flex justify-between text-xs text-gray-500">
          <span>
            Prioridade: 
            <span class="inline-block px-2 py-0.5 rounded-full font-medium 
              {% if tarefa.prioridade == 'alta' %} bg-red-100 text-red-700
              {% elif tarefa.prioridade == 'media' %} bg-yellow-100 text-yellow-800
              {% elif tarefa.prioridade == 'baixa' %} bg-green-100 text-green-700
              {% else %} bg-gray-100 text-gray-600
              {% endif %}">
              {{ tarefa.get_prioridade_display }}
            </span>
          </span>

          {% if tarefa.data_limite %}
            <span>üïì At√© {{ tarefa.data_limite|date:"d/m/Y" }}</span>
          {% endif %}
        </div>
      </li>
      {% empty %}
      <li class="py-3 text-gray-400 italic">Nenhuma tarefa cadastrada.</li>
      {% endfor %}
    </ul>

    <div class="mt-6 text-right">
      <a href="{% url 'app_tarefas:list_tarefas' %}" class="text-blue-600 hover:underline text-sm font-medium">
        ‚ûï Ver todas as tarefas
      </a>
    </div>
  </div>
  <br>
  <h2 class="text-lg font-bold mt-8 mb-4 text-gray-700">üìã Resumo dos Benef√≠cios</h2>

  <div class="overflow-x-auto border rounded shadow-sm bg-white">
    <table class="min-w-full text-sm text-left text-gray-700">
      <thead class="bg-gray-100 text-gray-600 text-xs">
        <tr>
          <th class="px-4 py-2">Benef√≠cio</th>
          <th class="px-2 py-2">UF</th>
          <th class="px-2 py-2">Ano</th>
          {% for key, label in beneficio_status_labels.items %}
            <th class="px-2 py-2 text-center">{{ label }}</th>
          {% endfor %}
          <th class="px-2 py-2 text-center font-semibold">Total</th>  <!-- üëà NOVO -->
        </tr>
      </thead>
      <tbody>
        {% for item in beneficio_status_data %}
          <tr class="border-t hover:bg-gray-50">
            <td class="px-4 py-2 font-semibold">{{ item.nome }}</td>
            <td class="px-2 py-2">{{ item.estado }}</td>
            <td class="px-2 py-2">{{ item.ano }}</td>
            {% for key, label in beneficio_status_labels.items %}
              <td class="px-2 py-2 text-center">
                {{ item.status|get_item:key|default:"0" }}
              </td>
            {% endfor %}
            <td class="px-2 py-2 text-center font-bold text-gray-800">{{ item.total }}</td>  <!-- üëà NOVO -->
          </tr>
        {% empty %}
          <tr>
            <td colspan="99" class="px-4 py-4 text-center text-gray-400">Nenhum benef√≠cio cadastrado.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  




    <!-- Container Principal do Painel -->
        <!-- Sess√£o 1 -->
        <div class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-gray-100">
          <h3 class="text-gray-700 font-semibold text-sm mb-4">Lista de Mensagens (leads-associe-se) . Total: <strong class="text-blue-500">{{ total_leads }}</strong></h3>
          <a href="{% url 'app_home:list_mensagens' %}" class="flex items-center text-blue-700 hover:text-green-600 transition-colors">
            <i class="material-icons mr-2">check_circle</i>
            Mensagens do formul√°rio de informa√ß√µes
          </a>
          <br>
          <div class="overflow-x-auto">
              <table class="min-w-full bg-white rounded-lg shadow-md">
                  <thead>
                      <tr class="bg-gray-200 text-gray-600 text-sm leading-normal">
                          <th class="py-3 px-6 text-left">Nome</th>
                          <th class="py-3 px-6 text-left">Celular</th>
                          <th class="py-3 px-6 text-left">Email</th>
                          <th class="py-3 px-6 text-left">Mensagem</th>
                      </tr>
                  </thead>
                  <tbody class="text-gray-600 text-sm font-light">
                      {% for lead in leads %}
                      <tr class="border-b border-gray-200 hover:bg-gray-100">
                          <td class="py-3 px-6 text-left whitespace-nowrap">{{ lead.nome }}</td>
                          <td class="py-3 px-6 text-left whitespace-nowrap">{{ lead.celular }}</td>
                          <td class="py-3 px-6 text-left whitespace-nowrap">{{ lead.email }}</td>
                          <td class="py-3 px-6 text-left">{{ lead.mensagem }}</td>
                      </tr>
                      {% empty %}
                      <tr>
                          <td colspan="4" class="py-3 px-6 text-center text-gray-500">Nenhuma mensagem encontrada.</td>
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
          </div>
        </div>
      <br>

      <div class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-gray-100">
      <h3 class="text-gray-700 font-semibold text-sm mb-4">Mensagens de Contato. Total: <strong class="text-orange-500">{{ total_mensagens }}</strong></h3>
      
      <a href="{% url 'app_home:list_contact_messages' %}" class="flex items-center text-orange-500 hover:text-purple-600 transition-colors">
          <i class="material-icons mr-2">email</i>
          Mensagens do formul√°rio de Contato
      </a>
      <br>
      <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded-lg shadow-md">
              <thead>
                  <tr class="bg-gray-200 text-gray-600 text-sm leading-normal">
                      <th class="py-3 px-6 text-left">Nome</th>
                      <th class="py-3 px-6 text-left">E-mail</th>
                      <th class="py-3 px-6 text-left">Assunto</th>
                      <th class="py-3 px-6 text-left">Mensagem</th>
                      <th class="py-3 px-6 text-left">Data</th>
                  </tr>
              </thead>
              <tbody class="text-gray-600 text-sm font-light">
                  {% for contato_mensagen in contato_mensagens %}
                  <tr class="border-b border-gray-200 hover:bg-gray-100">
                      <td class="py-3 px-6 text-left whitespace-nowrap">{{ contato_mensagen.name }}</td>
                      <td class="py-3 px-6 text-left whitespace-nowrap">{{ contato_mensagen.email }}</td>
                      <td class="py-3 px-6 text-left">{{ contato_mensagen.subject }}</td>
                      <td class="py-3 px-6 text-left">{{ contato_mensagen.message|truncatechars:50 }}</td>
                      <td class="py-3 px-6 text-left">{{ contato_mensagen.created_at|date:"d/m/Y H:i" }}</td>
                  </tr>
                  {% empty %}
                  <tr>
                      <td colspan="5" class="py-3 px-6 text-center text-gray-500">Nenhuma mensagem encontrada.</td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
    </div>
    <br>
    <div class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-gray-100">
      <!-- Cabe√ßalho do Painel -->
      <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
        <h2 class="text-lg font-semibold">Painel</h2>
        <p class="text-sm">Informa√ß√µes detalhadas e organizadas</p>
      </div>

      <!-- Corpo do Painel -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
          <!-- Sess√£o 1 -->
          <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
              <h3 class="text-gray-700 font-semibold text-sm">Quadro de Integrantes</h3>
              <p class="text-gray-600 text-sm mt-2">
                  Integrantes Operando: <strong class="text-blue-600 text-sm mt-2">{{ total_integrantes }}</strong>
              </p>
              <p class="text-gray-600 text-sm mt-2">
                Ex-Integrantes: <strong class="text-red-600 text-sm mt-2">{{ ex_integrantes }}</strong>
              </p>

          </div>

          <!-- Sess√£o 2 -->
          <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
              <h3 class="text-gray-700 font-semibold text-sm">Sess√£o 2</h3>
              <p class="text-gray-600 text-sm mt-2">
                  Outro espa√ßo para mais informa√ß√µes que voc√™ deseja exibir neste painel.
              </p>
          </div>

          <!-- Sess√£o 3 -->
          <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
              <h3 class="text-gray-700 font-semibold text-sm">Sess√£o 3</h3>
              <p class="text-gray-600 text-sm mt-2">
                  Adicione informa√ß√µes adicionais ou links relevantes nesta se√ß√£o.
              </p>
          </div>

          <!-- Sess√£o 4 -->
          <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
              <h3 class="text-gray-700 font-semibold text-sm">Sess√£o 4</h3>
              <p class="text-gray-600 text-sm mt-2">
                  Um espa√ßo final para qualquer outra coisa que voc√™ queira destacar.
              </p>
          </div>
      </div>
  </div>
  <br>
    <!-- Painel: Associa√ß√µes -->
<div class="bg-white shadow-lg rounded-xl p-8 mt-10 border border-gray-100">
  <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">ü§ù Associa√ß√µes</h2>
  <p class="text-center text-sm text-gray-500 mb-6">Contagem de associados por associa√ß√£o</p>

  <div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-200 rounded-md">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Associa√ß√£o</th>
          <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Associados</th>
        </tr>
      </thead>
      <tbody>
        {% for associacao in associados_por_associacao %}
        <tr class="border-t hover:bg-gray-50">
          <td class="px-4 py-2">{{ associacao.associacao__nome_fantasia }}</td>
          <td class="px-4 py-2">{{ associacao.associados_count }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2" class="text-center text-gray-400 py-4 italic">Nenhuma associa√ß√£o encontrada.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Painel: Reparti√ß√µes e Munic√≠pios -->
<div class="bg-white shadow-lg rounded-xl p-8 mt-12 border border-gray-100">
  <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">üìç Reparti√ß√µes e Munic√≠pios</h2>
  <p class="text-center text-sm text-gray-500 mb-6">Distribui√ß√£o de associados por local</p>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
    <!-- Reparti√ß√µes -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">üè¢ Reparti√ß√µes</h3>
      <p class="text-sm text-gray-500 mb-4">Contagem por reparti√ß√£o</p>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-md">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Reparti√ß√£o</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Associados</th>
            </tr>
          </thead>
          <tbody>
            {% for reparticao in associados_por_reparticao %}
            <tr class="border-t hover:bg-gray-50">
              <td class="px-4 py-2">{{ reparticao.reparticao__nome_reparticao }}</td>
              <td class="px-4 py-2">{{ reparticao.associados_count }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2" class="text-center text-gray-400 py-4 italic">Nenhuma reparti√ß√£o encontrada.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Munic√≠pios -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">üèôÔ∏è Munic√≠pios</h3>
      <p class="text-sm text-gray-500 mb-4">Contagem por munic√≠pio de circunscri√ß√£o</p>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-md">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Munic√≠pio</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Associados</th>
            </tr>
          </thead>
          <tbody>
            {% for municipio in associados_por_municipio_circunscricao %}
            <tr class="border-t hover:bg-gray-50">
              <td class="px-4 py-2">{{ municipio.municipio_circunscricao__municipio }}</td>
              <td class="px-4 py-2">{{ municipio.associados_count }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2" class="text-center text-gray-400 py-4 italic">Nenhum munic√≠pio encontrado.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <br><br>

  <!-- Bloco separado M√©tricas-->
    <!-- T√≠tulo Geral -->
    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Painel de M√©tricas</h3>

    <!-- Grid Responsivo em 2 colunas -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Gr√°fico de Associados por Reparti√ß√£o -->
      <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Associados por Reparti√ß√£o</h3>
        <canvas id="chartReparticoes" class="w-full h-60"></canvas>
      </div>
      <!-- Gr√°fico de Associados por Munic√≠pios -->
      <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Associados Por Munic√≠pios</h3>
        <canvas id="chartMunicipios" class="w-full h-60"></canvas>
      </div>

      <!-- Gr√°fico de Associados por G√™nero -->
      <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Associados por G√™nero</h3>
        <canvas id="chart2" class="w-full h-60"></canvas>
      </div>

      <!-- Gr√°fico de Associados Por Status -->
      <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Associados Por Status</h3>
        <canvas id="chartStatus" class="w-full h-60"></canvas>
      </div>
    </div>
  </div>
</div>
</div>
</div>


</body>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="{% static 'js/chartReparticoes.js' %}"></script>
<script>
  const associadosHomens = {{ associados_homens }};
  const associadosMulheres = {{ associados_mulheres }};
  const associadosIndefinidos = {{ associados_indefinidos }};
</script>
<script src="{% static 'js/chartGenero.js' %}"></script>
<script>
  const associadosPorReparticao = {{ associados_por_reparticao_json|safe }};
</script>
<script src="{% static 'js/chartReparticoes.js' %}"></script>
<!-- Dados para o gr√°fico -->
<script>
  const associadosPorStatus = {{ associados_por_status_json|safe }};
</script>
<script src="{% static 'js/chartStatus.js' %}"></script>
<!-- Dados para o gr√°fico -->
<script>
  const associadosPorMunicipio = {{ associados_por_municipio_circunscricao_json|safe }};
</script>
<script src="{% static 'js/chartMunicipios.js' %}"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    try {
      const ctx = document.getElementById('graficoServicos').getContext('2d');
      
      // Parse os dados JSON
      const labels = JSON.parse('{{ grafico_servicos_labels|escapejs }}');
      const dataAssociado = JSON.parse('{{ grafico_servicos_associado|escapejs }}');
      const dataExtra = JSON.parse('{{ grafico_servicos_extra|escapejs }}');
      
      new Chart(ctx, {
        type: 'bar',  // Alterado para 'bar' em vez de 'line'
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Associados',
              data: dataAssociado,
              backgroundColor: '#2563eb',  // Cor principal para barras
              borderColor: '#1d4ed8',    // Cor da borda
              borderWidth: 1,
              borderRadius: 4,            // Bordas arredondadas
            },
            {
              label: 'Extra-Associados',
              data: dataExtra,
              backgroundColor: '#f97316', // Cor principal para barras
              borderColor: '#ea580c',     // Cor da borda
              borderWidth: 1,
              borderRadius: 4,            // Bordas arredondadas
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'üìä Servi√ßos Mensais - Associados vs Extra-Associados'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              },
              grid: {
                drawBorder: false,
                color: 'rgba(0, 0, 0, 0.05)'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    } catch (error) {
      console.error('Erro ao renderizar gr√°fico:', error);
    }
  });
</script>

<script>
  window.onload = function() {
      var ctx = document.getElementById("graficoAssociados").getContext("2d");

      // üîπ Pegamos os dados do Django e garantimos que s√£o v√°lidos
      var labels = JSON.parse('{{ anos_meses_filiacao|safe }}');
      var dataValues = JSON.parse('{{ total_associados_por_periodo|safe }}');

      if (labels.length === 0 || dataValues.length === 0) {
          console.error("‚ùå Nenhum dado para exibir no gr√°fico.");
          return;
      }

      new Chart(ctx, {
          type: "line",  // ‚úÖ Mudamos para gr√°fico de linha üìà
          data: {
              labels: labels,
              datasets: [{
                  label: "N√∫mero de Associados",
                  data: dataValues,
                  borderColor: "rgba(54, 162, 235, 1)",
                  backgroundColor: "rgba(54, 162, 235, 0.2)",
                  borderWidth: 2,
                  pointRadius: 4,  // üîπ Ponto em cada dado
                  pointBackgroundColor: "rgba(54, 162, 235, 1)",
                  tension: 0.4  // üîπ Suaviza as curvas da linha
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: { display: false }
              },
              scales: {
                  x: { 
                      title: { display: true, text: "Ano-M√™s" },
                      ticks: { autoSkip: true, maxTicksLimit: 10 }  // üîπ Evita polui√ß√£o no eixo X
                  },
                  y: { 
                      title: { display: true, text: "N√∫mero de Associados" },
                      beginAtZero: true
                  }
              }
          }
      });
  };
</script>

 <!-- Footer -->
  {% include "components/footer_associacao.html" %}
{% endblock dashboard %}
