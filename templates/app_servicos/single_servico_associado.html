{% extends 'base.html' %}
{% load static %}
{% load filter_campos_essenciais %}
{% load documento_extras %}

{% block title %}Servi√ßo {{ servico.associado.user.get_full_name }}{% endblock title %}

{% block single_servico %}
    <!-- Navbar -->
    {% if is_superuser %}
        {% include "components/navbar_associacao.html" %}

    {% elif is_admin_associacao %}
        {% include "components/navbar_administradores.html" %}

    {% elif is_diretor_associacao %}
        {% include "components/navbar_diretores.html" %} 

    {% elif is_presidente_associacao %}
        {% include "components/navbar_presidente.html" %} 

    {% elif is_delegado_reparticao %}
        {% include "components/navbar_delegados.html" %}

    {% elif is_auxiliar_associacao %}
        {% include "components/navbar_aux_associacao.html" %}        

    {% else %}
        {% include "components/navbar_aux_reparticao.html" %} 
    {% endif %}

    <main class="flex-grow">
      <div class="container mx-auto max-8xl bg-white p-6 rounded-lg shadow-lg">

        {% if messages %}
        <div class="space-y-4 mb-6">
            {% for message in messages %}
            <div class="flex items-start gap-3 p-4 rounded-lg shadow-md border-l-4 transition-all duration-300
                {% if message.tags == 'success' %}
                bg-green-50 border-green-500 text-green-800
                {% elif message.tags == 'error' %}
                bg-red-50 border-red-500 text-red-800
                {% elif message.tags == 'info' %}
                bg-blue-50 border-blue-500 text-blue-800
                {% else %}
                bg-gray-50 border-gray-500 text-gray-800
                {% endif %}
            ">
                <div class="pt-1">
                {% if message.tags == 'success' %}
                    <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" stroke-width="2"
                        viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                    </svg>
                {% elif message.tags == 'error' %}
                    <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" stroke-width="2"
                        viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                {% elif message.tags == 'info' %}
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" stroke-width="2"
                        viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M12 12h.01"/>
                    </svg>
                {% else %}
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" stroke-width="2"
                        viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 20h.01M12 4h.01"/>
                    </svg>
                {% endif %}
                </div>
                <div class="text-sm leading-relaxed">{{ message }}</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Container mais amplo e compacto -->
        <div class="max-w-screen-xl mx-auto bg-white p-6 rounded-lg shadow-md space-y-6">

          <!-- üîπ T√≠tulo Principal -->
          <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
            <i class="material-icons text-blue-500 mr-2">description</i> 
            Detalhes do Servi√ßo - Associado
          </h2>

          <!-- üî∏ Card Compactado com 3 Colunas -->
          <div class="bg-white rounded-xl shadow-md p-4 space-y-6 border border-gray-100">

            <!-- üîπ Cabe√ßalho -->
            <div class="flex flex-col md:flex-row md:items-center md:justify-between border-b pb-3">
              <div>
                <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                  <span class="material-icons text-blue-500 text-base">assignment</span>
                  Informa√ß√µes do Servi√ßo
                </h3>
                <p class="text-xs text-gray-500 mt-0.5">Registrado em {{ servico.data_inicio|date:"d/m/Y H:i" }}</p>
              </div>
              <span class="text-xs text-gray-400 mt-2 md:mt-0">
                √öltima altera√ß√£o: {{ servico.ultima_alteracao|date:"d/m/Y H:i" }}
              </span>
            </div>

            <!-- üîπ Grid de Dados - 3 colunas -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-sm text-gray-800">

              <!-- Propriet√°rio -->
              <div class="col-span-1">
                {% if servico.associado %}
                  <div class="bg-gray-50 border border-blue-200 rounded-lg p-3 shadow-sm flex flex-col gap-2">
                    <h4 class="text-sm font-semibold text-blue-800 flex items-center gap-1">
                      <span class="material-icons text-base">person</span>
                      Propriet√°rio
                    </h4>
                    <div class="flex items-center justify-between">
                      <p class="text-sm">{{ servico.associado.user.get_full_name }}</p>
                      <a href="{% url 'app_associados:single_associado' servico.associado.id %}" 
                        class="text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1"
                        title="Ver detalhes do associado (abre em nova guia)"
                        target="_blank" rel="noopener noreferrer">
                        <span class="material-icons text-sm">visibility</span> Ver (nova guia)
                      </a>
                    </div>

                  </div>
                {% else %}
                  <span class="text-gray-400 italic">Propriet√°rio n√£o informado</span>
                {% endif %}
              </div>

              <!-- Associa√ß√£o -->
              <div>
                <h4 class="text-sm font-semibold text-gray-700 mb-1">Associa√ß√£o Respons√°vel</h4>
                {% if servico.associacao %}
                  <p>{{ servico.associacao.nome_fantasia }}</p>
                {% else %}
                  <span class="text-gray-400 italic">N√£o informada</span>
                {% endif %}
              </div>

              <!-- Reparti√ß√£o -->
              <div>
                <h4 class="text-sm font-semibold text-gray-700 mb-1">Reparti√ß√£o Respons√°vel</h4>
                {% if servico.reparticao %}
                  <p>{{ servico.reparticao.nome_reparticao }}</p>
                {% else %}
                  <span class="text-gray-400 italic">N√£o informada</span>
                {% endif %}
              </div>

              <!-- Status -->
              <div>
                <h4 class="text-sm font-semibold text-gray-700 mb-1">Status do Servi√ßo</h4>
                <span class="inline-block px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-semibold">
                  {{ servico.get_status_etapa_display }}
                </span>
              </div>

              <!-- Valor -->
              <div>
                <h4 class="text-sm font-semibold text-gray-700 mb-1">Valor do Servi√ßo</h4>
                {% if servico.valor_servico %}
                  <p class="text-green-600 font-semibold">R$ {{ servico.valor_servico|floatformat:2 }}</p>
                {% else %}
                  <span class="text-gray-400 italic">N√£o informado</span>
                {% endif %}
              </div>

              <!-- Tipo de Servi√ßo -->
              <div>
                <h4 class="text-sm font-semibold text-gray-700 mb-1 flex items-center gap-1">
                  <span class="material-icons text-base text-yellow-500">work_outline</span>
                  Tipo de Servi√ßo
                </h4>
                <p class="text-gray-800 text-sm">{{ servico.tipo_servico }}</p>
              </div>
            </div>

            <!-- Descri√ß√£o (1 Coluna) -->
            {% if servico.content %}
              <div class="mt-2">
                <h4 class="text-sm font-semibold text-gray-700 mb-2">üìù Descri√ß√£o do Servi√ßo:</h4>
                <div class="bg-gray-50 border border-gray-200 rounded-md p-3 shadow-sm text-sm text-gray-700 leading-relaxed">
                  {{ servico.content|safe }}
                </div>
              </div>
            {% endif %}
          </div>

          <div class="grid grid-cols-1 md:[grid-template-columns:300px_300px_1fr] gap-6 mb-6">

            <!-- üü¶ Coluna 1: Drive -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm bg-white">
              <h3 class="text-blue-950 text-sm font-semibold mb-2 flex items-center">
                Upload e Pasta Drive
              </h3>
              {% if associado.drive_folder_id %}
                <a href="https://drive.google.com/drive/folders/{{ associado.drive_folder_id }}"
                  target="_blank"
                  class="flex items-center text-blue-600 hover:underline font-medium mb-2">
                  <img src="https://www.gstatic.com/images/branding/product/2x/drive_2020q4_48dp.png"
                      alt="Google Drive"
                      class="w-6 h-6 mr-2">
                  <span>Acessar Pasta no Drive</span>
                </a>
                <p class="text-xs text-gray-600 mb-3">Pasta criada automaticamente. Acesse ou envie arquivos.</p>
                <a href="{% url 'app_documentos:upload_docs' associado.id %}?next={% url 'app_servicos:single_servico' servico.id %}"
                  class="inline-flex items-center px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-md shadow-sm transition focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1">
                  <svg class="w-4 h-4 mr-1 -ml-1 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                      viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 4v16m8-8H4"/>
                  </svg>
                  Enviar Documento Drive
                </a>
              {% else %}
                <p class="text-sm italic text-gray-500">Nenhuma pasta associada.</p>
              {% endif %}
            </div>

            <!-- üü® Coluna 2: Conta Gov -->
            <div class="border border-gray-200 rounded-lg p-4 shadow-sm bg-white space-y-4">
              <h3 class="text-blue-950 text-sm font-semibold mb-2 flex items-center">
                Conta Gov
              </h3>
              <!-- CPF -->
              <div class="flex items-center text-sm">
                  <i class="material-icons text-red-500 mr-2" style="font-size: 18px;">fingerprint</i>
                  <strong class="mr-2">CPF:</strong>
                  <span id="cpf-{{ associado.pk }}">{{ associado.cpf }}</span>
                  <button onclick="copyToClipboard('cpf-{{ associado.pk }}')" class="ml-2 text-gray-600 hover:text-orange-500">
                    <i class="material-icons" style="font-size: 16px;">content_copy</i>
                  </button>
                </div>

                <!-- Senha Gov -->
                <div class="flex items-center text-sm">
                  <i class="material-icons text-red-500 mr-2" style="font-size: 18px;">lock</i>
                  <strong class="mr-2">Senha:</strong>
                  <span id="senha-gov-{{ associado.pk }}">{{ associado.senha_gov }}</span>
                  <button onclick="copyToClipboard('senha-gov-{{ associado.pk }}')" class="ml-2 text-gray-600 hover:text-yellow-500">
                    <i class="material-icons" style="font-size: 16px;">content_copy</i>
                  </button>
                </div>
                <!-- Servi√ßos Relacionados -->
                <div class="mt-2 border-t border-gray-200 pt-2">
                  <p class="text-xs text-gray-600 mb-1 flex items-center">
                    <i class="material-icons text-blue-400 mr-1" style="font-size: 16px;">assignment</i>
                    Servi√ßos deste Associado:
                  </p>

                  {% if outros_servicos %}
                    <ul class="text-xs text-blue-700 space-y-1">
                      {% for outro in outros_servicos|slice:":3" %}
                        <li>
                          <a href="{% url 'app_servicos:single_servico' outro.id %}" class="hover:underline hover:text-blue-900">
                            ‚Ä¢ {{ outro.tipo_servico|default:"Servi√ßo" }} - {{ outro.created_at|date:"d/m/Y" }}
                          </a>
                        </li>
                      {% endfor %}
                      {% if quantidade_total_servicos > 3 %}
                        <li class="text-gray-500">+{{ quantidade_total_servicos|add:"-3" }} servi√ßos</li>
                      {% endif %}
                    </ul>
                  {% else %}
                    <p class="text-xs text-gray-400 italic">Nenhum outro servi√ßo.</p>
                  {% endif %}
                </div>

              </div>

                <!-- üü© Coluna 3: Dados MAPA/Question√°rio (mant√©m como estava em 2 colunas internas) -->
                <div class="border border-gray-200 rounded-lg p-4 shadow-sm bg-white">
                  <h3 class="text-blue-950 text-sm font-semibold mb-2 flex items-center">
                    Participa√ß√µes / Perfil
                  </h3>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-800">
                  <div>
                    <strong>Recolhe INSS:</strong><br>
                    <span>{{ associado.recolhe_inss|default:"‚Äî" }}</span>
                  </div>
                  <div>
                    <strong>Recebe Seguro:</strong><br>
                    <span>{{ associado.recebe_seguro|default:"‚Äî" }}</span>
                  </div>
                  <div>
                    <strong>Defeso alguma vez:</strong><br>
                    <span>{{ associado.ja_recebeu_defeso_algumavez|default:"‚Äî" }}</span>
                  </div>
                  <div>
                    <strong>Comercializa Produtos:</strong><br>
                    <span>{{ associado.comercializa_produtos|default:"‚Äî" }}</span>
                  </div>
                  <div>
                    <strong>Outra Renda:</strong><br>
                    <span>{{ associado.outra_fonte_renda|default:"‚Äî" }}</span>
                  </div>
                  <div>
                    <strong>Bolsa Fam√≠lia:</strong><br>
                    <span>{{ associado.bolsa_familia|default:"‚Äî" }}</span>
                  </div>
                  <div>
                    <strong>Rela√ß√£o de Trabalho:</strong><br>
                    <span>{{ associado.relacao_trabalho|default:"‚Äî" }}</span>
                  </div>
                  <div>
                    <strong>Casa onde mora:</strong><br>
                    <span>{{ associado.casa_onde_mora|default:"‚Äî" }}</span>
                  </div>
                </div>
              </div>
            </div>


            <div class="bg-white p-6 rounded-lg shadow-md mt-6">
              <div class="mb-10">
                <h2 class="text-sm font-semibold text-gray-600 border-b pb-1 mb-4 uppercase tracking-wider">üìÑ Dados Pessoais</h2>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-y-4 gap-x-6 text-sm text-gray-800">

                  <!-- Nome -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Nome:</span>
                    <span id="nome-{{ associado.pk }}">{{ associado.user.get_full_name }}</span>
                    <button onclick="copyToClipboard('nome-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Celular -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Celular:</span>
                    <span id="celular-{{ associado.pk }}">{{ associado.celular }}</span>
                    <button onclick="copyToClipboard('celular-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-green-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Nome do Pai -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Pai:</span>
                    <span id="pai-{{ associado.pk }}">{{ associado.nome_pai }}</span>
                    <button onclick="copyToClipboard('pai-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-purple-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- RG -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">RG:</span>
                    <span id="rg-numero-{{ associado.pk }}">{{ associado.rg_numero }}</span>
                    <button onclick="copyToClipboard('rg-numero-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- √ìrg√£o Expedidor -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">√ìrg√£o:</span>
                    <span id="rg-orgao-{{ associado.pk }}">{{ associado.rg_orgao }}</span>
                    <button onclick="copyToClipboard('rg-orgao-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-green-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Data de Emiss√£o do RG -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Emiss√£o RG:</span>
                    <span id="rg-data-emissao-{{ associado.pk }}">{{ associado.rg_data_emissao|date:"d/m/Y" }}</span>
                    <button onclick="copyToClipboard('rg-data-emissao-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-yellow-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Naturalidade -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Naturalidade:</span>
                    <span id="naturalidade-{{ associado.pk }}">{{ associado.naturalidade }}</span>
                    <button onclick="copyToClipboard('naturalidade-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-purple-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Data de Nascimento -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Nascimento:</span>
                    <span id="data_nascimento-{{ associado.pk }}">{{ associado.data_nascimento|date:"d/m/Y" }}</span>
                    <button onclick="copyToClipboard('data_nascimento-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-pink-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- NIT -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">NIT:</span>
                    <span id="nit-{{ associado.pk }}">{{ associado.nit }}</span>
                    <button onclick="copyToClipboard('nit-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- T√≠tulo de Eleitor -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">T√≠tulo Eleitor:</span>
                    <span id="titulo-eleitor-{{ associado.pk }}">{{ associado.titulo_eleitor }}</span>
                    <button onclick="copyToClipboard('titulo-eleitor-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-yellow-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- CAEPF -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">CAEPF:</span>
                    <span id="caepef-{{ associado.pk }}">{{ associado.caepef }}</span>
                    <button onclick="copyToClipboard('caepef-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-yellow-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- CEI -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">CEI:</span>
                    <span id="cei-{{ associado.pk }}">{{ associado.cei }}</span>
                    <button onclick="copyToClipboard('cei-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-yellow-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- RGP -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">RGP:</span>
                    <span id="rgp-{{ associado.pk }}">{{ associado.rgp }}</span>
                    <button onclick="copyToClipboard('rgp-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Emiss√£o RGP -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Emiss√£o RGP:</span>
                    <span id="rgp-data-emissao-{{ associado.pk }}">{{ associado.rgp_data_emissao|date:"d/m/Y" }}</span>
                    <button onclick="copyToClipboard('rgp-data-emissao-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-green-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- CNH -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">CNH:</span>
                    <span id="cnh-{{ associado.pk }}">{{ associado.cnh }}</span>
                    <button onclick="copyToClipboard('cnh-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Emiss√£o CNH -->
                  <div class="flex items-center">
                    <span class="font-medium text-gray-700 mr-2">Emiss√£o CNH:</span>
                    <span id="cnh-data-emissao-{{ associado.pk }}">{{ associado.cnh_data_emissao|date:"d/m/Y" }}</span>
                    <button onclick="copyToClipboard('cnh-data-emissao-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-green-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                </div>
              </div>
            </div>

            <!-- Se√ß√£o: Endere√ßo -->
            <div class="bg-white p-6 rounded-lg shadow-md mt-6">
              <div class="mb-8">
                <h2 class="text-sm font-semibold text-gray-600 border-b pb-1 mb-4 uppercase tracking-wider">
                  üìç Endere√ßo
                </h2>

                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-y-4 gap-x-6 text-sm text-gray-800">


                  <!-- Logradouro -->
                  <div class="flex items-center">
                    <span class="font-medium mr-2 text-gray-700">Logradouro:</span>
                    <span id="logradouro-{{ associado.pk }}">{{ associado.logradouro }}</span>
                    <button onclick="copyToClipboard('logradouro-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- N√∫mero -->
                  <div class="flex items-center">
                    <span class="font-medium mr-2 text-gray-700">N√∫mero:</span>
                    <span id="numero-{{ associado.pk }}">{{ associado.numero }}</span>
                    <button onclick="copyToClipboard('numero-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Complemento -->
                  <div class="flex items-center">
                    <span class="font-medium mr-2 text-gray-700">Complemento:</span>
                    <span id="complemento-{{ associado.pk }}">{{ associado.complemento }}</span>
                    <button onclick="copyToClipboard('complemento-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Bairro -->
                  <div class="flex items-center">
                    <span class="font-medium mr-2 text-gray-700">Bairro:</span>
                    <span id="bairro-{{ associado.pk }}">{{ associado.bairro }}</span>
                    <button onclick="copyToClipboard('bairro-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- Munic√≠pio -->
                  <div class="flex items-center">
                    <span class="font-medium mr-2 text-gray-700">Munic√≠pio:</span>
                    <span id="municipio-{{ associado.pk }}">{{ associado.municipio }}</span>
                    <button onclick="copyToClipboard('municipio-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- UF -->
                  <div class="flex items-center">
                    <span class="font-medium mr-2 text-gray-700">UF:</span>
                    <span id="uf-{{ associado.pk }}">{{ associado.uf }}</span>
                    <button onclick="copyToClipboard('uf-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>

                  <!-- CEP -->
                  <div class="flex items-center">
                    <span class="font-medium mr-2 text-gray-700">CEP:</span>
                    <span id="cep-{{ associado.pk }}">{{ associado.cep }}</span>
                    <button onclick="copyToClipboard('cep-{{ associado.pk }}')" class="ml-2 text-gray-500 hover:text-blue-500">
                      <i class="material-icons text-sm">content_copy</i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

          <!-- ACORDE√ÇOS app_servicos/single_servico.html -->
          {% if servico.tipo_servico and servico.tipo_servico.nome %}
            {% if servico.tipo_servico.nome == "Assessoria para Registro de Seguro Embarca√ß√£o (DPEM)" %}
              <div class="bg-blue-50 p-4 rounded shadow mb-6">
                <h2 class="text-lg font-bold text-blue-800">üõ• DPEM - Orienta√ß√µes</h2>
                <p class="text-sm text-blue-700 mt-1">
                  Acesse o portal da seguradora, re√∫na os documentos da embarca√ß√£o e RG do propriet√°rio. Ap√≥s isso, inicie o cadastro.
                </p>
                <p class="text-sm text-green-700 mt-1">
                  Nada Ainda...
                </p>                   
              </div>

            {% elif servico.tipo_servico.nome == "Auxilio Emiss√£o Licen√ßas (MAPA)" %}
              <div class="bg-green-50 p-4 rounded shadow mb-6">
                <h2 class="text-lg font-bold text-green-800">üåø MAPA - Licen√ßas</h2>
                <p class="text-sm text-green-700 mt-1">
                  Consulte a lista de produtos permitidos, acesse o sistema do MAPA e inicie a emiss√£o com base no CPF do pescador.
                </p>
                <p class="text-sm text-green-700 mt-1">
                  Nada Ainda...
                </p>                
              </div>

            {% elif servico.tipo_servico.nome == "Auxilio Emiss√£o e Registro de Embarca√ß√£o (TIE)" %}
              <div class="bg-yellow-50 p-4 rounded shadow mb-6">
                <h2 class="text-lg font-bold text-yellow-800">‚öì TIE - Registro de Embarca√ß√£o</h2>
                <p class="text-sm text-yellow-700 mt-1 mb-4">
                  Re√∫na os documentos da embarca√ß√£o e do propriet√°rio. Inicie o processo no site da Marinha ou Capitania dos Portos.
                </p>
                <!--Acordeon Registro Inicial-->
                <div x-data="{ open: false }" class="mb-6">
                <!-- Bot√£o do acorde√£o -->
                <button 
                  @click="open = !open"
                  class="w-full text-left bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-semibold px-4 py-2 rounded-md transition flex items-center justify-between">
                  üõ• INICIAL - Inscri√ß√£o de Embarca√ß√µes Esporte/Recreio at√© 12m
                  <span class="material-icons text-base" x-text="open ? 'expand_less' : 'expand_more'"></span>
                </button>

                <!-- Conte√∫do do acorde√£o -->
                <div x-show="open" x-transition x-cloak class="mt-2 bg-white border border-blue-200 rounded-md shadow p-4 text-sm space-y-4 leading-relaxed text-gray-700">
                  
                  <p>
                    <strong>Inscri√ß√£o de Embarca√ß√µes de Esporte e Recreio</strong> na Jurisdi√ß√£o da Capitania dos Portos de Santa Catarina.
                    Este documento detalha os procedimentos e requisitos para a inscri√ß√£o de embarca√ß√µes com comprimento de at√© 12 metros.
                  </p>

                  <p class="text-red-700">
                    <strong>‚ö†Ô∏è Observa√ß√£o Importante:</strong> A partir da data de aquisi√ß√£o, o prazo para inscri√ß√£o de embarca√ß√µes de Esporte e/ou Recreio com comprimento menor que 24 metros √© de <strong>60 dias</strong>, conforme item 2.4 da Normam-211/DPC. Ap√≥s esse prazo, o propriet√°rio estar√° sujeito a multa.
                  </p>

                  <h4 class="font-semibold text-blue-800">A) Documenta√ß√£o e Requisitos Necess√°rios</h4>
                  <ul class="list-disc list-inside space-y-1">
                    <li>Baixe e preencha o requerimento √† CPSC.</li>
                    <li>Baixe o Modelo do BSADE e siga as instru√ß√µes para preenchimento.</li>
                    <li>Imprima o requerimento e o BSADE em duas vias.</li>
                    <li><strong>Documenta√ß√£o:</strong></li>
                    <ul class="list-disc list-inside pl-4">
                      <li><strong>Identidade do propriet√°rio:</strong> RG + CPF (se n√£o constar no RG)</li>
                      <li><strong>Pessoa Jur√≠dica:</strong> CNPJ + Contrato Social</li>
                      <li><strong>Representa√ß√£o:</strong> Procura√ß√£o com firma reconhecida + RG/CPF do procurador</li>
                      <li><strong>Prova de propriedade da embarca√ß√£o:</strong> Nota fiscal do casco ou documentos espec√≠ficos conforme a situa√ß√£o</li>
                      <li><strong>Cat√°logo/Manual ou Declara√ß√£o do Fabricante</strong> com: comprimento, boca, lota√ß√£o, pot√™ncia e registro no CREA</li>
                      <li><strong>Motor acima de 50HP:</strong> prova de propriedade</li>
                      <li><strong>Comprovante de resid√™ncia:</strong> at√© 90 dias</li>
                      <li><strong>Fotos:</strong> 2 fotos coloridas e datadas da embarca√ß√£o</li>
                    </ul>
                    <li class="text-red-700">
                      Desde 1¬∫ de JULHO de 2024, √© exigido o pagamento do DPEM/2024 conforme Normam-211/212.
                    </li>
                  </ul>

                  <h4 class="font-semibold text-blue-800">B) Indeniza√ß√£o do(s) Servi√ßo(s)</h4>
                  <ul class="list-disc list-inside space-y-1">
                    <li>Acesse o sistema de emiss√£o da GRU</li>
                    <li>Selecione <strong>Capitania dos Portos de Santa Catarina</strong></li>
                    <li>Escolha o servi√ßo:
                      <ul class="pl-4 list-disc">
                        <li>T√çTULO DE INSCRI√á√ÉO DE EMBARCA√á√ÉO (TIE) - ESPORTE E RECREIO</li>
                      </ul>
                    </li>
                    <li>Preencha com os dados do interessado</li>
                    <li class="italic text-gray-600">A guia estar√° dispon√≠vel em at√© 24h ap√≥s emiss√£o</li>
                    <li>Se aquisi√ß√£o for por aliena√ß√£o, emitir tamb√©m GRU de:
                      <ul class="pl-4 list-disc">
                        <li>REGISTRO DE √îNUS E AVERBA√á√ïES - INSCRITA NA CP/DL/AG</li>
                      </ul>
                    </li>
                  </ul>
                  <!-- INICIAL Download docs-->
                  <h4 class="text-sm font-semibold text-blue-800">üìé Documentos para Download</h4>
                  {% get_docs_padrao "Requerimento de Registro Inicial (TIE)" "Requerimento de Registro Inicial (TIE) - Modelo BSADE" as documentos %}

                  {% if documentos %}
                    <div class="bg-white p-4 rounded shadow-sm mt-4">
                      {% for doc in documentos %}
                        <div class="flex items-center justify-between text-sm border-b py-2">
                          <span class="text-gray-800">{{ doc.tipo_doc.tipo }}</span>
                          <a href="{{ doc.arquivo.url }}" class="text-blue-600 hover:underline" target="_blank">
                            Baixar ({{ doc.arquivo|extensao }})
                          </a>
                        </div>
                      {% endfor %}
                    </div>
                  {% else %}
                    <p class="text-gray-500 italic text-sm">Nenhum documento padr√£o encontrado.</p>
                  {% endif %}

                  <div class="pt-2">
                    üîó <a href="https://www.marinha.mil.br/cpsc/Insc12" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                      Clique aqui para acessar o site da Marinha (CPSC)
                    </a>
                  </div>
                  <div class="pt-2">
                    üîó <a href="https://sistemas.dpc.mar.mil.br/sisap/agendamento/#/" target="_blank" rel="noopener noreferrer" class="text-blue-700 hover:underline">
                      Acessar Guia Recolhimento (GRU)
                    </a>
                  </div>                    
                </div>
              </div>
              <!--Acordeon Renova√ß√£o-->
              <div x-data="{ open: false }" class="mb-6">
                <!-- Bot√£o do acorde√£o -->
                <button 
                  @click="open = !open"
                  class="w-full text-left bg-yellow-300 hover:bg-yellow-400 text-yellow-900 font-semibold px-4 py-2 rounded-md transition flex items-center justify-between">
                  ‚öì Renova√ß√£o: TIE - Embarca√ß√£o de Esporte e Recreio at√© 12m
                  <span class="material-icons text-base" x-text="open ? 'expand_less' : 'expand_more'"></span>
                </button>

                <!-- Conte√∫do do acorde√£o -->
                <div x-show="open" x-transition x-cloak class="mt-2 bg-white border border-yellow-300 rounded-md shadow p-4 text-sm space-y-4 leading-relaxed text-gray-700">
                  
                  <p>
                    <strong>Inscri√ß√£o de Embarca√ß√µes de Esporte e Recreio</strong> na Jurisdi√ß√£o da Capitania dos Portos de Santa Catarina. Este documento detalha os procedimentos e requisitos para a inscri√ß√£o de embarca√ß√µes com comprimento de at√© 12 metros.
                  </p>

                  <p class="text-red-700">
                    <strong>‚ö†Ô∏è Observa√ß√£o Importante:</strong> O prazo para inscri√ß√£o ap√≥s aquisi√ß√£o √© de <strong>60 dias</strong>, conforme item 2.4 da Normam-211/DPC. Ap√≥s isso, o propriet√°rio pode ser multado.
                  </p>

                  <h4 class="font-semibold text-yellow-800">A) Documenta√ß√£o e Requisitos Necess√°rios</h4>
                  <ul class="list-disc list-inside space-y-1">
                    <li>Baixe e preencha o requerimento √† CPSC.</li>
                    <li>Baixe o Modelo do BSADE e siga as instru√ß√µes.</li>
                    <li>Imprima o requerimento e o BSADE (2 vias).</li>
                    <li>Documenta√ß√£o pessoal:
                      <ul class="pl-4 list-disc">
                        <li>Pessoa F√≠sica: RG + CPF</li>
                        <li>Pessoa Jur√≠dica: CNPJ + Contrato Social</li>
                        <li>Representa√ß√£o: Procura√ß√£o + RG/CPF</li>
                      </ul>
                    </li>
                    <li>Prova de propriedade da embarca√ß√£o:
                      <ul class="pl-4 list-disc">
                        <li>Compra: Nota fiscal do casco</li>
                        <li>Outros casos: Ver Normam-211/212 item 2.8</li>
                      </ul>
                    </li>
                    <li>Cat√°logo ou declara√ß√£o do fabricante com:
                      <ul class="pl-4 list-disc">
                        <li>Comprimento</li>
                        <li>Boca (largura)</li>
                        <li>Lota√ß√£o</li>
                        <li>Pot√™ncia m√°xima</li>
                        <li>Registro no CREA</li>
                      </ul>
                    </li>
                    <li>Prova de propriedade do motor (caso > 50HP)</li>
                    <li>Comprovante de resid√™ncia (at√© 90 dias)</li>
                    <li>Duas fotos coloridas e datadas da embarca√ß√£o</li>
                    <li class="text-red-700">A partir de 1¬∫ de JULHO de 2024, √© exigido DPEM 2024 (item 2.6 das Normam-211/212)</li>
                  </ul>

                  <h4 class="font-semibold text-yellow-800">B) Emiss√£o da GRU</h4>
                  <ul class="list-disc list-inside space-y-1">
                    <li>Acesse o sistema da GRU</li>
                    <li>Selecione a <strong>Capitania dos Portos de Santa Catarina</strong></li>
                    <li>Escolha:
                      <ul class="pl-4 list-disc">
                        <li><strong>T√çTULO DE INSCRI√á√ÉO DE EMBARCA√á√ÉO (TIE)</strong> - ESPORTE E RECREIO</li>
                      </ul>
                    </li>
                    <li>Preencha os dados do interessado</li>
                    <li class="italic text-gray-600">Pagamento dispon√≠vel ap√≥s 24h</li>
                    <li>Se aquisi√ß√£o por aliena√ß√£o:
                      <ul class="pl-4 list-disc">
                        <li>Escolha: <strong>REGISTRO DE √îNUS E AVERBA√á√ïES - INSCRITA NA CP/DL/AG</strong></li>
                      </ul>
                    </li>
                  </ul>
                  <!--RENOVA√á√ÉO - Download docs-->
                  <h4 class="text-sm font-semibold text-blue-800">üìé Documentos para Download</h4>
                  {% get_docs_padrao "Requerimento RENOVA√á√ÉO (TIE) - Modelo BSADE" "Requerimento RENOVA√á√ÉO (TIE) - Modelo BSADE (Propriet√°rio1)" "Requerimento RENOVA√á√ÉO (TIE) - Modelo BSADE (Propriet√°rio2)" "Termo Responsabilidade de Seguran√ßa da Navega√ß√£o (TIE)" as documentos %}

                  {% if documentos %}
                    <div class="bg-white p-4 rounded shadow-sm mt-4">
                      {% for doc in documentos %}
                        <div class="flex items-center justify-between text-sm border-b py-2">
                          <span class="text-gray-800">{{ doc.tipo_doc.tipo }}</span>
                          <a href="{{ doc.arquivo.url }}" class="text-blue-600 hover:underline" target="_blank">
                            Baixar ({{ doc.arquivo|extensao }})
                          </a>
                        </div>
                      {% endfor %}
                    </div>
                  {% else %}
                    <p class="text-gray-500 italic text-sm">Nenhum documento padr√£o encontrado.</p>
                  {% endif %}

                  <div class="pt-2">
                    üîó <a href="https://www.marinha.mil.br/cpsc/renovacao" target="_blank" rel="noopener noreferrer" class="text-yellow-700 hover:underline">
                      Acessar site da Marinha (CPSC)
                    </a>
                  </div>
                  <div class="pt-2">
                    üîó <a href="https://sistemas.dpc.mar.mil.br/sisap/agendamento/#/" target="_blank" rel="noopener noreferrer" class="text-yellow-700 hover:underline">
                      Acessar Guia Recolhimento (GRU)
                    </a>
                  </div>                  
                </div>
              </div>
              <!--Acordeon Segunda Via TIE-->
              <div x-data="{ open: false }" class="mb-6">
                <!-- Bot√£o do acorde√£o -->
                <button 
                  @click="open = !open"
                  class="w-full text-left bg-yellow-200 hover:bg-yellow-300 text-red-900 font-semibold px-4 py-2 rounded-md transition flex items-center justify-between">
                  üßæ 2¬™ Via do TIE - Embarca√ß√£o de Esporte/Recreio
                  <span class="material-icons text-base" x-text="open ? 'expand_less' : 'expand_more'"></span>
                </button>

                <!-- Conte√∫do do acorde√£o -->
                <div x-show="open" x-transition x-cloak class="mt-2 bg-white border border-red-300 rounded-md shadow p-4 text-sm space-y-4 leading-relaxed text-gray-700">
                  
                  <p>
                    <strong>2¬™ Via do T√≠tulo de Inscri√ß√£o (TIE)</strong> para embarca√ß√µes de esporte e/ou recreio. Este processo √© v√°lido para situa√ß√µes de perda, roubo ou extravio do documento.
                  </p>

                  <p class="text-red-700">
                    <strong>‚ö†Ô∏è Observa√ß√£o Importante:</strong> Se a embarca√ß√£o estiver inscrita em outra jurisdi√ß√£o, a renova√ß√£o do TIE deve ser solicitada no √≥rg√£o original de inscri√ß√£o, conforme item 2.7 da Normam-211/DPC (ou 2.2 da Normam-212/DPC para motoaqu√°ticas).
                  </p>

                  <h4 class="font-semibold text-red-800">üìú TIE emitido at√© 06/03/2023 (Modelo Antigo)</h4>
                  <p>
                    Nestes casos, o propriet√°rio ou representante legal deve solicitar a renova√ß√£o diretamente na Capitania, Delegacia ou Ag√™ncia respons√°vel. O novo documento ser√° emitido por meio digital (aplicativo).
                    <br>
                    <em>Link para renova√ß√£o via app: <span class="text-gray-400 italic">(n√£o fornecido)</span></em>
                  </p>

                  <h4 class="font-semibold text-red-800">üì≤ TIE Digital - Consulta e Impress√£o</h4>
                  <ul class="list-disc list-inside space-y-1">
                    <li>Consulta pode ser feita a qualquer momento via aplicativo oficial</li>
                    <li>Documento digital cont√©m <strong>QR Code</strong> para fiscaliza√ß√£o</li>
                    <li>Se desejar imprimir, o propriet√°rio pode faz√™-lo direto do app ‚Äî <strong>sem custos</strong> e <strong>sem necessidade de ir at√© a Capitania</strong></li>
                  </ul>

                  <h4 class="font-semibold text-red-800">üè¢ Impress√£o do TIE via Capitania (caso sem acesso √† internet)</h4>
                  <p>O cidad√£o poder√° solicitar a impress√£o do TIE diretamente em uma Capitania, Delegacia ou Ag√™ncia. Para isso, deve:</p>
                  <ul class="list-decimal list-inside space-y-1">
                    <li>Apresentar um requerimento com o motivo da solicita√ß√£o</li>
                    <li>Levar a mesma documenta√ß√£o exigida para renova√ß√£o (exceto o TIE original)</li>
                  </ul>

                  <!--Seguinda Via - Download docs-->
                  <h4 class="text-sm font-semibold text-blue-800">üìé Documentos para Download</h4>
                  {% get_docs_padrao "Requerimento RENOVA√á√ÉO (TIE) - Modelo BSADE" "Requerimento RENOVA√á√ÉO (TIE) - Modelo BSADE (Propriet√°rio1)" "Requerimento RENOVA√á√ÉO (TIE) - Modelo BSADE (Propriet√°rio2)" "Termo Responsabilidade de Seguran√ßa da Navega√ß√£o (TIE)" as documentos %}

                  {% if documentos %}
                    <div class="bg-white p-4 rounded shadow-sm mt-4">
                      {% for doc in documentos %}
                        <div class="flex items-center justify-between text-sm border-b py-2">
                          <span class="text-gray-800">{{ doc.tipo_doc.tipo }}</span>
                          <a href="{{ doc.arquivo.url }}" class="text-blue-600 hover:underline" target="_blank">
                            Baixar ({{ doc.arquivo|extensao }})
                          </a>
                        </div>
                      {% endfor %}
                    </div>
                  {% else %}
                    <p class="text-gray-500 italic text-sm">Nenhum documento padr√£o encontrado.</p>
                  {% endif %}
                  
                  <div class="pt-2">
                    üîó <a href="https://www.marinha.mil.br/cpsc/2via" target="_blank" rel="noopener noreferrer" class="text-red-700 hover:underline">
                      Acessar site da Marinha ‚Äì 2¬™ Via do TIE / OBS: Na p√°g, link que redireciona para Renova√ß√£o
                    </a>
                  </div>
                  <div class="pt-2">
                    üîó <a href="https://www.marinha.mil.br/cpsc/renovacao" target="_blank" rel="noopener noreferrer" class="text-yellow-700 hover:underline">
                      Acessar site da Marinha (CPSC) - RENOVA√á√ÉO/2 Via
                    </a>
                  </div>
                  <div class="pt-2">
                    üîó <a href="https://sistemas.dpc.mar.mil.br/sisap/agendamento/#/" target="_blank" rel="noopener noreferrer" class="text-yellow-700 hover:underline">
                      Acessar Guia Recolhimento (GRU)
                    </a>
                  </div>                   
                </div>
              </div>

              </div>

            {% elif servico.tipo_servico.nome == "Aux√≠lio Emiss√£o RGP" %}
              <div class="bg-indigo-50 p-4 rounded shadow mb-6">
                <h2 class="text-lg font-bold text-indigo-800">üêü RGP - Registro Geral da Pesca</h2>
                <p class="text-sm text-indigo-700 mt-1">
                  Verifique os dados no Sistema do MPA, atualize informa√ß√µes do pescador e siga o fluxo de emiss√£o.
                </p>
                <!-- Acorde√£o de Orienta√ß√µes -->
                  <div x-data="{ open: false }" class="mt-4">
                    <button
                      @click="open = !open"
                      class="w-full text-left bg-indigo-100 hover:bg-indigo-200 text-indigo-900 font-semibold px-4 py-2 rounded-md transition flex items-center justify-between">
                      üìÑ Instru√ß√µes para Emiss√£o do RGP
                      <span class="material-icons text-base" x-text="open ? 'expand_less' : 'expand_more'"></span>
                    </button>

                    <div x-show="open" x-cloak x-transition class="mt-2 bg-white border border-indigo-200 rounded-md shadow p-4 text-sm leading-relaxed text-gray-700 space-y-4">

                      <h4 class="font-semibold text-indigo-800">üìå Documenta√ß√£o Necess√°ria:</h4>
                      <ul class="list-disc list-inside space-y-1">
                        <li>üìé CPF</li>
                        <li>üìé RG ou CNH</li>
                        <li>üìé NIT (N√∫mero de Identifica√ß√£o do Trabalhador)</li>
                        <li>üìé Comprovante de resid√™ncia no nome ou <strong>Declara√ß√£o de Resid√™ncia modelo MAPA</strong></li>
                        <li>üìé Foto 3x4 (pode ser tirada com celular, mostrando ombros e rosto)</li>
                        <li>üìé Conta GOV + senha GOV.BR</li>
                      </ul>

                      <h4 class="font-semibold text-indigo-800">üß† Perguntas obrigat√≥rias:</h4>
                      <ul class="list-disc list-inside space-y-1">
                        <li>J√° recebeu Seguro Defeso?</li>
                        <li>J√° recebeu Bolsa Fam√≠lia?</li>
                        <li>A casa onde mora √©: alugada, pr√≥pria ou cedida?</li>
                        <li>Qual a escolaridade (at√© que s√©rie estudou)?</li>
                        <li>Qual a etnia (Branco, Pardo, Preto, Ind√≠gena)?</li>
                        <li>J√° teve algum registro de pesca anteriormente?</li>
                      </ul>

                      <!--RGP - Download docs-->
                      <h4 class="text-sm font-semibold text-blue-800">üìé Documentos para Download</h4>
                      {% get_docs_padrao "Declara√ß√£o Resid√™ncia - MAPA" as documentos %}

                      {% if documentos %}
                        <div class="bg-white p-4 rounded shadow-sm mt-4">
                          {% for doc in documentos %}
                            <div class="flex items-center justify-between text-sm border-b py-2">
                              <span class="text-gray-800">{{ doc.tipo_doc.tipo }}</span>
                              <a href="{{ doc.arquivo.url }}" class="text-blue-600 hover:underline" target="_blank">
                                Baixar ({{ doc.arquivo|extensao }})
                              </a>
                            </div>
                          {% endfor %}
                        </div>
                      {% else %}
                        <p class="text-gray-500 italic text-sm">Nenhum documento padr√£o encontrado.</p>
                      {% endif %}        
                      <h4 class="font-semibold text-indigo-800">üîó Acessos √öteis:</h4>
                      <ul class="list-disc list-inside space-y-1">
                        <li>
                          <a href="https://meu.inss.gov.br/#/login" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                            Meu INSS ‚Äì Login (consulta do NIT)
                          </a>
                        </li>
                        <li>
                          <a href="https://pesqbrasil-pescadorprofissional.agro.gov.br/" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                            Portal RGP ‚Äì Pescador Profissional
                          </a>
                        </li>
                      </ul>

                    </div>
                  </div>
                </div>

            {% endif %}
          {% endif %}


            <!-- Se√ß√£o: Embarca√ß√µes-->
            <div class="bg-white p-6 rounded-lg shadow-md mt-6">
              <div class="mb-8">
                <h2 class="text-sm font-semibold text-gray-600 border-b pb-1 mb-4 uppercase tracking-wider">
                  <i class="material-icons mr-2">sailing</i> Embarca√ß√µes
                </h2>              
                {% if associado.embarcacoes.exists %}
                <div x-data="{ openBoat: null }" class="space-y-4 mt-6">
                  <h2 class="text-base font-semibold text-gray-700 mb-2">‚õµ Embarca√ß√µes do Associado</h2>

                  {% for embarcacao in associado.embarcacoes.all %}
                    <div class="border rounded-md shadow-sm overflow-hidden">
                      <button @click="openBoat === {{ forloop.counter }} ? openBoat = null : openBoat = {{ forloop.counter }}"
                              class="w-full px-4 py-2 bg-blue-100 text-left text-sm font-medium text-blue-800 hover:bg-blue-200 flex justify-between items-center">
                        {{ embarcacao.nome_embarcacao }} - {{ embarcacao.inscricao_embarcacao }}
                        <i class="material-icons text-base">expand_more</i>
                      </button>

                      <div x-show="openBoat === {{ forloop.counter }}" x-transition class="p-4 bg-white text-sm text-gray-700 space-y-2">
                        <p><strong>Validade TIE:</strong> {{ embarcacao.validade_tie|date:"d/m/Y" }}</p>
                        <p><strong>Porte:</strong> {{ embarcacao.porte }}</p>
                        <p><strong>Tipo Propuls√£o:</strong> {{ embarcacao.tipo_propulsao }}</p>
                        <p><strong>Combust√≠vel:</strong> {{ embarcacao.combustivel }}</p>
                        <p><strong>Co-propriet√°rio:</strong> {{ embarcacao.co_proprietario_nome }}</p>
                        <p><strong>Seguro DPEN:</strong> {{ embarcacao.seguro_dpen }}</p>
                        <p><strong>Seguro DPEM N¬∫:</strong> {{ embarcacao.seguro_dpem_numero }}</p>
                        <p><strong>Vencimento DPEM:</strong> {{ embarcacao.seguro_dpem_data_vencimento|date:"d/m/Y" }}</p>

                        {% if embarcacao.licencas.exists %}
                          <div x-data="{ openLic: false }" class="mt-4">
                            <button @click="openLic = !openLic"
                                    class="text-blue-700 font-medium hover:underline">
                              üìÑ Ver Licen√ßas ({{ embarcacao.licencas.count }})
                            </button>
                            <div x-show="openLic" x-transition class="mt-2 space-y-2 border-l pl-4">
                              {% for licenca in embarcacao.licencas.all %}
                                <div class="border border-gray-100 rounded-md p-2 bg-gray-50">
                                  <p><strong>√ìrg√£o:</strong> {{ licenca.orgao_nome }}</p>
                                  <p><strong>Licen√ßa:</strong> {{ licenca.licenca_nome }}</p>
                                  <p><strong>C√≥digo Frota:</strong> {{ licenca.codigo_frota }}</p>
                                  <p><strong>Inscri√ß√£o Aut. Naval:</strong> {{ licenca.inscricao_aut_naval }}</p>
                                  <p><strong>Validade:</strong> {{ licenca.validade_final|date:"d/m/Y" }}</p>
                                </div>
                              {% endfor %}
                            </div>
                          </div>
                        {% else %}
                          <p class="text-gray-500 text-sm mt-2 italic">Nenhuma licen√ßa vinculada.</p>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-sm mt-2 italic">Este Associado n√£o possui embarca√ß√µes vinculadas em seu nome.</p>
                {% endif %}
              </div>
            </div>

            <!-- üî∏ A√ß√µes -->                
            <div class="mt-8 flex flex-wrap items-center justify-between gap-4">
              <div class="bg-white p-6 rounded-lg shadow-md mt-6">
                <!-- üîô Voltar para lista -->
                <a href="{% url 'app_servicos:list_servicos' %}" 
                  class="inline-flex items-center text-sm text-blue-600 hover:text-blue-800 transition">
                  <i class="material-icons text-base mr-1">arrow_back</i> Voltar para lista
                </a>
              
                <!-- ‚úèÔ∏è Editar servi√ßo (associado) -->
                {% if servico.pk %}
                <a href="{% url 'app_servicos:edit_servico_associado' servico.pk %}" 
                  class="inline-flex items-center text-sm text-yellow-600 hover:text-yellow-800 transition">
                  <i class="material-icons text-base mr-1">edit</i> Editar Servi√ßo
                </a>
                {% endif %}
              </div>
            </div>

            {% if documentos_relevantes %}
            <div class="bg-white p-6 rounded-lg shadow-md mt-6">
              <!-- T√≠tulo e par√°grafo com estilo mais suave -->
              <div class="mb-4">
                <h2 class="text-sm font-semibold text-gray-800 mb-1 flex items-center gap-1">
                  <i class="material-icons text-blue-400 text-base">attach_file</i>
                  Documentos Relevantes <span class="text-xs text-gray-500">(somente ESSENCIAIS)</span>
                </h2>

                <p class="text-xs text-gray-600">
                  N√£o encontrou o documento <strong class="text-gray-800 font-medium">essencial</strong> que procurava?
                  Fa√ßa o upload clicando no bot√£o abaixo:
                </p>
              </div>

              <!-- Bot√£o Upload compacto e elegante -->
              <a href="{% url 'app_documentos:upload_documento' 'associado' associado.pk %}"
                class="inline-flex items-center gap-2 bg-gray-300 hover:bg-green-300 text-sm text-blue-600 px-3 py-1.5 rounded-md shadow-sm border border-gray-300 transition"
                title="Upload de Documento">
                <i class="material-icons text-blue-500 text-base">upload_file</i>
                <span>Upload de Documento</span>
              </a><br><br>

              <ul class="space-y-4">
                {% for doc in documentos_relevantes %}
                <li class="flex items-center justify-between bg-gray-50 border p-3 rounded-md">
                  <div>
                    <p class="text-sm font-medium text-gray-800">
                      <i class="material-icons text-sm text-blue-400 align-middle">insert_drive_file</i>
                      {{ doc.tipo_doc.tipo }} ‚Äì 
                      <a href="{{ doc.arquivo.url }}" class="text-blue-600 hover:underline" target="_blank">Visualizar</a>
                    
                    <span class="inline-block text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full ml-2">
                      {{ doc.arquivo.url|slice:"-3:"|upper }}
                    </span>
                  </p>
                    <p class="text-xs text-gray-500">Enviado em {{ doc.data_upload|date:"d/m/Y H:i" }}</p>
                  </div>
                  <a href="{% url 'app_documentos:download_documento' doc.pk %}" class="text-green-600 hover:text-green-800" title="Baixar Documento">
                    <i class="material-icons">cloud_download</i>
                  </a>
                </li>
                {% endfor %}
              </ul>
            </div>
            {% else %}
              <p class="text-gray-500 text-sm italic mt-4">Nenhum documento RG, RGP ou NIT foi encontrado para o associado.</p>
            {% endif %}
            
            </div>              
            <!-- üî∏ Tabela Alternativa (se necess√°rio) -->
            {% if historico %}
            <div class="bg-white border border-blue-100 rounded-md p-4 mt-8 shadow-sm">
              <h3 class="text-blue-700 font-semibold mb-3 text-lg flex items-center">
                <i class="material-icons mr-2">history</i> Hist√≥rico do Servi√ßo
              </h3>
              <table class="table-auto w-full text-sm">
                <thead>
                  <tr class="bg-blue-50 text-left text-xs text-gray-600">
                    <th class="px-3 py-2">Campo</th>
                    <th class="px-3 py-2">De</th>
                    <th class="px-3 py-2">Para</th>
                    <th class="px-3 py-2">Alterado por</th>
                    <th class="px-3 py-2">Data</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                  {% for h in historico %}
                  <tr>
                    <td class="px-3 py-2 font-medium">{{ h.campo }}</td>
                    <td class="px-3 py-2 text-gray-600">{{ h.valor_antigo|safe }}</td>
                    <td class="px-3 py-2 text-blue-700 font-semibold">{{ h.valor_novo|safe }}</td>
                    <td class="px-3 py-2">{{ h.alterado_por.get_full_name }}</td>
                    <td class="px-3 py-2 text-xs">{{ h.data_alteracao|date:"d/m/Y H:i" }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </main>
<!-- CSS do Editor -->
<link rel="stylesheet" href="{% static 'css/editor.css' %}">
<script src="{% static 'js/copy_to_clipboard.js' %}"></script>
<script src="//unpkg.com/alpinejs" defer></script>
<script src="https://unpkg.com/alpinejs" defer></script>
{% include "components/footer_associacao.html" %}
{% endblock single_servico %}
